# é•¿ç¯‡å°è¯´ç³»ç»Ÿè®¾è®¡æ–‡æ¡£ï¼ˆ200+ ç« ï¼‰

**æ—¥æœŸ**: 2026-02-04
**ç‰ˆæœ¬**: v4.0 - é•¿ç¯‡ä¼˜åŒ–ç‰ˆ
**ç›®æ ‡**: æ”¯æŒ 200+ ç« ï¼ˆ50ä¸‡å­—ä»¥ä¸Šï¼‰çš„é«˜è´¨é‡å°è¯´ç”Ÿæˆ

---

## ğŸ“‹ ç›®å½•

1. [è®¾è®¡èƒŒæ™¯](#è®¾è®¡èƒŒæ™¯)
2. [æ ¸å¿ƒé—®é¢˜åˆ†æ](#æ ¸å¿ƒé—®é¢˜åˆ†æ)
3. [æ•´ä½“æ¶æ„](#æ•´ä½“æ¶æ„)
4. [åˆ†å±‚è®°å¿†ç³»ç»Ÿ](#åˆ†å±‚è®°å¿†ç³»ç»Ÿ)
5. [RAG å¢å¼ºç³»ç»Ÿ](#rag-å¢å¼ºç³»ç»Ÿ)
6. [ä¸‰å±‚æ•…äº‹ç»“æ„](#ä¸‰å±‚æ•…äº‹ç»“æ„)
7. [å¤šå±‚è´¨é‡æ£€æŸ¥](#å¤šå±‚è´¨é‡æ£€æŸ¥)
8. [å®ç°è®¡åˆ’](#å®ç°è®¡åˆ’)

---

## è®¾è®¡èƒŒæ™¯

### å½“å‰ç³»ç»Ÿé™åˆ¶

ç°æœ‰ç³»ç»Ÿï¼ˆç»ˆæå®Œç¾ç‰ˆ v3.0ï¼‰åœ¨å¤„ç† 200+ ç« é•¿ç¯‡æ—¶ä¼šé‡åˆ°ä¸¥é‡é—®é¢˜ï¼š

| é—®é¢˜ | ä¸¥é‡æ€§ | å½±å“ç« èŠ‚ | åæœ |
|------|--------|----------|------|
| ä¼ç¬”å¹´é¾„è®¡ç®—é”™è¯¯ | ğŸ”´ è‡´å‘½ | ç¬¬10ç« + | é€»è¾‘å´©æºƒ |
| Memory ç´¯ç§¯çˆ†ç‚¸ | ğŸ”´ è‡´å‘½ | ç¬¬150ç« + | ç³»ç»Ÿå´©æºƒ |
| æ— ä¼ç¬”è§£å†³æœºåˆ¶ | ğŸŸ  ä¸¥é‡ | ç¬¬50ç« + | é€»è¾‘æ··ä¹± |
| æ€§èƒ½çº¿æ€§ä¸‹é™ | ğŸŸ¡ ä¸­ç­‰ | å…¨ç¨‹ | é€Ÿåº¦å˜æ…¢ |
| è§’è‰²æ€§æ ¼æ¼‚ç§» | ğŸŸ¡ ä¸­ç­‰ | ç¬¬100ç« + | è´¨é‡ä¸‹é™ |
| ä¸»çº¿åç¦»é£é™© | ğŸŸ  ä¸¥é‡ | ç¬¬100ç« + | æ•…äº‹å´©æºƒ |

### è®¾è®¡ç›®æ ‡

1. **å¯æ‰©å±•æ€§**: æ”¯æŒ 200+ ç« ï¼Œç³»ç»Ÿä¸å´©æºƒ
2. **è´¨é‡ä¿è¯**: é•¿ç¯‡ä¹Ÿèƒ½ä¿æŒè§’è‰²ä¸€è‡´æ€§ã€é€»è¾‘è¿è´¯æ€§
3. **æ€§èƒ½ç¨³å®š**: ç”Ÿæˆé€Ÿåº¦ä¸éšç« èŠ‚æ•°çº¿æ€§ä¸‹é™
4. **æˆæœ¬å¯æ§**: API æˆæœ¬åœ¨åˆç†èŒƒå›´ï¼ˆ< $20/æœ¬ï¼‰

---

## æ ¸å¿ƒé—®é¢˜åˆ†æ

### é—®é¢˜ 1: ä¼ç¬”å¹´é¾„è®¡ç®—é”™è¯¯

**å½“å‰ä»£ç ** (plot_manager.py:34):
```python
thread_age = len(plot_threads) - i  # âŒ é”™è¯¯
```

**é—®é¢˜**:
- å‡è®¾ä¼ç¬”åœ¨åˆ—è¡¨ä¸­çš„ä½ç½®ä»£è¡¨å¹´é¾„
- åˆ°ç¬¬100ç« ï¼Œä¼ç¬”åˆ—è¡¨æœ‰50ä¸ªå…ƒç´ æ—¶ï¼š
  - ç¬¬1ç« åŸ‹çš„ä¼ç¬”å¹´é¾„ = 50-0 = 50 âŒï¼ˆå®é™…åº”è¯¥æ˜¯99ï¼‰
  - ç¬¬50ç« åŸ‹çš„ä¼ç¬”å¹´é¾„ = 50-49 = 1 âŒï¼ˆå®é™…åº”è¯¥æ˜¯50ï¼‰

**è§£å†³æ–¹æ¡ˆ**:
```python
# å­˜å‚¨ä¼ç¬”æ—¶è®°å½•åˆ›å»ºç« èŠ‚
plot_threads = [
    {"text": "ä¼ç¬”A", "created_at": 1, "resolved": False},
    {"text": "ä¼ç¬”B", "created_at": 50, "resolved": False}
]

# è®¡ç®—å¹´é¾„
thread_age = current_chapter - thread["created_at"]
```

### é—®é¢˜ 2: Memory ç´¯ç§¯çˆ†ç‚¸

**å½“å‰ä»£ç ** (memory.py:199, 206, 213):
```python
# æ°¸è¿œè¿½åŠ ï¼Œä»ä¸åˆ é™¤
updated_bible["characters"][char_name]["notes"].append(update)
updated_bible["plot_threads"].extend(plot_developments)
updated_bible["world_events"].extend(world_changes)
```

**åæœ**:
- åˆ°ç¬¬200ç« : 600æ¡è§’è‰²ç¬”è®° + 400ä¸ªä¼ç¬” + 200ä¸ªäº‹ä»¶ = 1200+ æ¡è®°å½•
- Planner prompt ä¼šè¶…å‡º Claude ä¸Šä¸‹æ–‡çª—å£
- ç³»ç»Ÿåœ¨ç¬¬150ç« å·¦å³å´©æºƒ

**è§£å†³æ–¹æ¡ˆ**: åˆ†å±‚è®°å¿†ï¼ˆè§ä¸‹æ–‡ï¼‰

### é—®é¢˜ 3: æ— ä¼ç¬”è§£å†³æœºåˆ¶

**é—®é¢˜**:
- plot_threads åª extendï¼Œä»ä¸æ ‡è®°"å·²è§£å†³"
- AI æ­ç¤ºä¼ç¬”åï¼Œåˆ—è¡¨ä¸­ä»ä¿ç•™
- åˆ°200ç« ä¼šæœ‰å‡ ç™¾ä¸ª"åƒµå°¸ä¼ç¬”"

**è§£å†³æ–¹æ¡ˆ**:
```python
# æ·»åŠ  resolved å­—æ®µ
thread = {
    "text": "ä¼ç¬”A",
    "created_at": 1,
    "resolved": False,
    "resolved_at": None
}

# å·å®¡æŸ¥æ—¶æ£€æŸ¥å¹¶æ ‡è®°
if ai_check_thread_resolved(thread, volume_chapters):
    thread["resolved"] = True
    thread["resolved_at"] = current_chapter
```

---

## æ•´ä½“æ¶æ„

### ç³»ç»Ÿå±‚æ¬¡

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Level 1: æ€»çº² (Novel Outline)                       â”‚
â”‚  - æ•´ä½“ç›®æ ‡ã€ä¸»çº¿å†²çªã€ä¸»è§’æˆé•¿çº¿                      â”‚
â”‚  - å…³é”®é‡Œç¨‹ç¢‘ï¼ˆç¬¬50ã€100ã€150ã€200ç« ï¼‰                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                        â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Level 2: å·æ¡†æ¶ (Volume Frameworks)                 â”‚
â”‚  - 8-10ä¸ªå·ï¼Œæ¯å·25ç«                                  â”‚
â”‚  - æ¯å·çš„æ ¸å¿ƒç›®æ ‡ã€å…³é”®äº‹ä»¶ã€ä¼ç¬”å®‰æ’                   â”‚
â”‚  - é¢„å…ˆè§„åˆ’å¥½ï¼Œä¿æŒæ•´ä½“è¿è´¯                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                        â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Level 3: åŠ¨æ€å·çº² (Dynamic Volume Outline)          â”‚
â”‚  - æ¯å·å¼€å§‹æ—¶ï¼ŒAIåŸºäºå·æ¡†æ¶+å½“å‰çŠ¶æ€ç”Ÿæˆè¯¦ç»†å¤§çº²        â”‚
â”‚  - å°†25ç« åˆ†ä¸º3-5ä¸ªé˜¶æ®µ                                â”‚
â”‚  - æ˜ç¡®ä¼ç¬”åŸ‹å…¥å’Œæ­ç¤ºæ—¶æœº                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                        â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Level 4: ç« èŠ‚ (Chapters)                            â”‚
â”‚  - ç°æœ‰çš„ Planner â†’ Writer â†’ Critic æµç¨‹              â”‚
â”‚  - ä¿æŒä¸å˜                                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### å·¥ä½œæµæ›´æ–°

```
åˆå§‹åŒ–
  â†“
Volume Planner (å·è§„åˆ’)
  â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ ç« èŠ‚å¾ªç¯ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Planner â†’ Writer â†’ Critic         â”‚
â”‚           â†“                        â”‚
â”‚      éœ€ä¿®è®¢? â†’ è¿”å›Writer (æœ€å¤š2æ¬¡) â”‚
â”‚           â†“                        â”‚
â”‚         Memory                     â”‚
â”‚           â†“                        â”‚
â”‚    å®Œæˆ25ç« ? â†’ å¦ â†’ ç»§ç»­           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
  â†“ æ˜¯
Volume Review (å·å®¡æŸ¥)
  â†“
è®°å¿†å‹ç¼©
  â†“
å®Œæˆæ‰€æœ‰å·? â†’ å¦ â†’ è¿”å› Volume Planner
  â†“ æ˜¯
å®Œæˆ

é‡Œç¨‹ç¢‘å®¡æŸ¥ï¼ˆæ¯50ç« è§¦å‘ï¼‰
```

---

## åˆ†å±‚è®°å¿†ç³»ç»Ÿ

### æ ¸å¿ƒæ¦‚å¿µ

**ä¸¤çº§è®°å¿†**:
- **çƒ­è®°å¿† (Hot Memory)**: å½“å‰å·çš„è¯¦ç»†è®°å¿†
- **å†·è®°å¿† (Cold Memory)**: å†å²å·çš„å‹ç¼©æ‘˜è¦

### æ•°æ®ç»“æ„

```python
class LayeredMemory:
    hot_memory = {
        "current_volume": 4,
        "chapters_in_volume": 8,
        "characters": {
            "é™†æ²‰": {
                "core_traits": "è°¨æ…ã€ç†æ€§ã€æœ‰æ­£ä¹‰æ„Ÿ",  # æ°¸ä¹…
                "recent_notes": [  # åªä¿ç•™å½“å‰å·
                    "ç¬¬76ç« : é‡åˆ°æ–°ä¼™ä¼´",
                    "ç¬¬77ç« : å¼€å§‹ä¿¡ä»»"
                ]
            }
        },
        "plot_threads": {
            "active": [  # æ´»è·ƒä¼ç¬”ï¼ˆæœ€è¿‘20ç« ï¼‰
                {
                    "text": "å¼ äº‘èº«ä»½ä¹‹è°œ",
                    "created_at": 77,
                    "importance": 8,
                    "resolved": False
                }
            ]
        },
        "world_events": [
            # å½“å‰å·çš„ä¸–ç•Œå˜åŒ–
        ]
    }

    cold_memory = {
        "volume_summaries": [
            {
                "volume": 1,
                "chapters": "1-25",
                "summary": "ç¬¬1å·ç²¾ç‚¼æ‘˜è¦ï¼ˆ500å­—ï¼‰",
                "character_arcs": {
                    "é™†æ²‰": "ä»å­¤åƒ»å°‘å¹´æˆé•¿ä¸ºä¿®ç‚¼è€…"
                },
                "resolved_threads": [
                    {"text": "å­¤å„¿é™¢çš„ç§˜å¯†", "revealed_at": 20}
                ]
            }
        ]
    }
```

### å·ç»“æŸæ—¶çš„å‹ç¼©æµç¨‹

```python
def compress_volume_on_completion(state, volume_index):
    """
    å·å®Œæˆæ—¶ï¼ˆ25ç« ï¼‰:
    1. AI ç”Ÿæˆå·æ‘˜è¦ï¼ˆ500å­—ï¼‰
    2. AI å‹ç¼©è§’è‰²å‘å±•ï¼ˆæ¯è§’è‰²100å­—ï¼‰
    3. æ ‡è®°å·²è§£å†³ä¼ç¬”
    4. æ¸…ç©ºçƒ­è®°å¿†
    5. ä¿å­˜åˆ°å†·è®°å¿†
    """

    # 1. å·æ‘˜è¦
    volume_summary = ai_summarize_volume(
        chapters=get_volume_chapters(state, volume_index),
        max_length=500
    )

    # 2. è§’è‰²å‘å±•æ‘˜è¦
    character_arcs = {}
    for char in state["characters"]:
        arc = ai_summarize_character_arc(
            character=char,
            notes=char["recent_notes"],
            max_length=100
        )
        character_arcs[char["name"]] = arc

    # 3. æ£€æŸ¥ä¼ç¬”è§£å†³æƒ…å†µ
    resolved_threads = []
    for thread in state["plot_threads"]["active"]:
        if ai_check_thread_resolved(thread, volume_chapters):
            thread["resolved"] = True
            resolved_threads.append(thread)

    # 4. ä¿å­˜å†·è®°å¿†
    cold_memory.append({
        "volume": volume_index,
        "summary": volume_summary,
        "character_arcs": character_arcs,
        "resolved_threads": resolved_threads
    })

    # 5. æ¸…ç©ºçƒ­è®°å¿†
    for char in state["characters"]:
        char["recent_notes"] = []

    # 6. ç§»é™¤å·²è§£å†³ä¼ç¬”
    state["plot_threads"]["active"] = [
        t for t in state["plot_threads"]["active"]
        if not t["resolved"]
    ]
```

### Prompt é•¿åº¦æ§åˆ¶

**åˆ°ç¬¬200ç« æ—¶**:
- çƒ­è®°å¿†: å½“å‰å·25ç« ï¼ˆçº¦5000å­—ï¼‰
- å†·è®°å¿†: 7ä¸ªå·æ‘˜è¦ï¼ˆ7Ã—500=3500å­—ï¼‰
- æ€»è®¡: 8500å­—ï¼ˆvs åŸæ¥çš„å‡ ä¸‡å­—ï¼‰

---

## RAG å¢å¼ºç³»ç»Ÿ

### æ¶æ„é€‰æ‹©

**æ··åˆæ–¹æ¡ˆ**:
- **ä¸»è¦**: åˆ†å±‚æ‘˜è¦è®°å¿†
- **è¾…åŠ©**: è½»é‡ RAGï¼ˆChromaDBï¼Œåªå­˜æ‘˜è¦ï¼‰

### ChromaDB é›†æˆ

```python
class NovelRAGMemory:
    def __init__(self, novel_title):
        self.client = chromadb.PersistentClient(
            path=f"./rag_storage/{novel_title}"
        )

        # ä¸‰ä¸ªé›†åˆ
        self.chapters = self.client.get_or_create_collection("chapters")
        self.threads = self.client.get_or_create_collection("threads")
        self.volumes = self.client.get_or_create_collection("volumes")

    def add_chapter(self, index, summary, volume):
        """æ¯ç« å®Œæˆåæ·»åŠ æ‘˜è¦"""
        self.chapters.add(
            documents=[summary],
            ids=[f"ch_{index}"],
            metadatas=[{"chapter": index, "volume": volume}]
        )

    def retrieve_similar_chapters(self, query, current_chapter, k=5):
        """è¯­ä¹‰æ£€ç´¢ç›¸ä¼¼æƒ…èŠ‚"""
        results = self.chapters.query(
            query_texts=[query],
            n_results=k,
            where={"chapter": {"$lt": current_chapter}}
        )
        return results["documents"][0]
```

### ä½¿ç”¨åœºæ™¯

1. **Planner è§„åˆ’æ—¶**: æ£€ç´¢"ç›¸ä¼¼å†å²æƒ…èŠ‚"
2. **Writer å†™ä½œæ—¶**: æ£€ç´¢"è§’è‰²åœ¨ç±»ä¼¼åœºæ™¯çš„è¡¨ç°"
3. **Critic è¯„å®¡æ—¶**: æ£€ç´¢"ç±»ä¼¼åœºæ™¯çš„å¤„ç†æ–¹å¼"

### æ•°æ®é‡ä¼°ç®—

åˆ°ç¬¬200ç« :
- 200ä¸ªç« èŠ‚æ‘˜è¦ï¼ˆ100å­—/ä¸ªï¼‰= 20,000å­—
- 50ä¸ªæ´»è·ƒä¼ç¬”ï¼ˆ50å­—/ä¸ªï¼‰= 2,500å­—
- 8ä¸ªå·æ‘˜è¦ï¼ˆ500å­—/ä¸ªï¼‰= 4,000å­—
- **æ€»è®¡**: 26,500å­—å‘é‡åº“ï¼ˆå®Œå…¨å¯æ¥å—ï¼‰

---

## ä¸‰å±‚æ•…äº‹ç»“æ„

### Level 1: æ€»çº²

```python
novel_outline = {
    "main_goal": "ä¸»è§’ä»å‡¡äººä¿®ç‚¼æˆä»™å¸ï¼Œå®ˆæŠ¤äººé—´",
    "total_volumes": 8,
    "total_chapters": 200,
    "main_conflict": "å¤©é“å°†å´©ï¼Œå¦–é­”å…¥ä¾µäººé—´",
    "protagonist_arc": "ä»å¤ä»‡è€…æˆé•¿ä¸ºå®ˆæŠ¤è€…",

    "key_milestones": [
        {"chapter": 50, "event": "ç­‘åŸºæˆåŠŸ"},
        {"chapter": 100, "event": "å‘ç°å¤©é“çœŸç›¸"},
        {"chapter": 150, "event": "åˆæˆ˜æœ€ç»ˆBOSS"},
        {"chapter": 200, "event": "æœ€ç»ˆå†³æˆ˜"}
    ]
}
```

### Level 2: å·æ¡†æ¶

```python
volume_frameworks = [
    {
        "volume": 1,
        "title": "åˆå…¥æ±Ÿæ¹–",
        "chapters": "1-25",
        "core_goal": "å»ºç«‹ä¸–ç•Œè§‚ï¼Œå¼•å…¥è§’è‰²ï¼ŒåŸ‹ä¸‹ä¼ç¬”",
        "key_events": ["å‘ç°ä¿®ç‚¼å¤©èµ‹", "é‡åˆ°å¯¼å¸ˆ", "åˆæˆ˜é‚ªæ¶"],
        "ending_state": "å†³å®šè¸ä¸Šä¿®ä»™ä¹‹è·¯",
        "foreshadowing": ["å¯¼å¸ˆèº«ä»½", "ä¸»è§’èº«ä¸–"]
    },
    # ... 8ä¸ªå·
]
```

### Level 3: åŠ¨æ€å·çº²ç”Ÿæˆ

```python
def generate_volume_outline(state, volume_index):
    """
    æ¯å·å¼€å§‹ï¿½ï¿½:
    1. è¯»å–å·æ¡†æ¶
    2. è¯»å–ä¸Šä¸€å·æ‘˜è¦ï¼ˆå¦‚æœæœ‰ï¼‰
    3. AI ç”Ÿæˆè¯¦ç»†å·çº²ï¼ˆ25ç« åˆ†3-5é˜¶æ®µï¼‰
    """

    framework = volume_frameworks[volume_index - 1]

    if volume_index > 1:
        prev_summary = cold_memory["volume_summaries"][-1]
        context = f"ä¸Šå·: {prev_summary['summary']}"
    else:
        context = "è¿™æ˜¯ç¬¬ä¸€å·"

    prompt = f"""
åŸºäºæ€»çº²å’Œå·æ¡†æ¶ï¼Œç”Ÿæˆç¬¬{volume_index}å·è¯¦ç»†å¤§çº²ã€‚

ã€æ€»çº²ã€‘
{format_novel_outline(novel_outline)}

ã€ä¸Šå·å›é¡¾ã€‘
{context}

ã€æœ¬å·æ¡†æ¶ã€‘
{format_volume_framework(framework)}

ã€ä»»åŠ¡ã€‘
å°†25ç« åˆ†ä¸º3-5ä¸ªé˜¶æ®µï¼Œæ˜ç¡®æ¯é˜¶æ®µçš„æƒ…èŠ‚å’Œä¼ç¬”ã€‚

ã€è¾“å‡ºæ ¼å¼ã€‘
## ç¬¬{volume_index}å·ï¼š{framework["title"]}

### ç¬¬ä¸€é˜¶æ®µï¼ˆç¬¬1-8ç« ï¼‰
...
"""

    volume_outline = ai_generate(prompt)
    return volume_outline
```

---

## å¤šå±‚è´¨é‡æ£€æŸ¥

### ä¸‰ä¸ªå±‚æ¬¡

```
Level 1: ç« èŠ‚çº§ (ç°æœ‰)
  - 5ç»´åº¦è¯„å®¡
  - ä¿®è®¢å¾ªç¯ï¼ˆæœ€å¤š2æ¬¡ï¼‰

Level 2: å·çº§ (æ–°å¢)
  - ç›®æ ‡å®Œæˆåº¦
  - è§’è‰²ä¸€è‡´æ€§
  - ä¼ç¬”è´¨é‡
  - èŠ‚å¥æ§åˆ¶

Level 3: é‡Œç¨‹ç¢‘çº§ (æ–°å¢)
  - æ€»çº²å¯¹é½åº¦
  - ä¸»çº¿è¿›åº¦
  - ä¼ç¬”å¥åº·åº¦
```

### å·çº§å®¡æŸ¥

```python
def volume_review_node(state):
    """
    æ¯25ç« è§¦å‘:
    1. æ£€æŸ¥å·ç›®æ ‡å®Œæˆåº¦ (0-100åˆ†)
    2. æ£€æŸ¥è§’è‰²ä¸€è‡´æ€§ (0-100åˆ†)
    3. æ£€æŸ¥ä¼ç¬”è´¨é‡ (0-100åˆ†)
    4. æ£€æŸ¥èŠ‚å¥æ§åˆ¶ (0-100åˆ†)
    """

    volume_chapters = get_volume_chapters(state)
    framework = volume_frameworks[current_volume - 1]

    scores = {
        "goal_completion": ai_check_goal_completion(
            chapters=volume_chapters,
            framework=framework
        ),
        "character_consistency": ai_check_character_consistency(
            chapters=volume_chapters
        ),
        "foreshadow_quality": ai_check_foreshadow_quality(
            chapters=volume_chapters,
            expected=framework["foreshadowing"]
        ),
        "pacing": ai_check_pacing(volume_chapters)
    }

    overall = sum(scores.values()) / len(scores)

    if overall < 70:
        print("âš ï¸ è­¦å‘Šï¼šæœ¬å·è´¨é‡åä½ï¼Œå»ºè®®äººå·¥å®¡æŸ¥")

    return scores
```

### é‡Œç¨‹ç¢‘å®¡æŸ¥

```python
def milestone_review_node(state):
    """
    æ¯50ç« è§¦å‘:
    1. æ£€æŸ¥æ€»çº²å¯¹é½åº¦
    2. æ£€æŸ¥ä¸»çº¿è¿›åº¦
    3. æ£€æŸ¥ä¼ç¬”å¥åº·åº¦
    """

    scores = {
        "outline_alignment": ai_check_outline_alignment(
            all_summaries=cold_memory["volume_summaries"],
            novel_outline=novel_outline
        ),
        "plot_progress": ai_check_plot_progress(state),
        "foreshadow_health": ai_check_foreshadow_health(
            active_threads=hot_memory["plot_threads"]["active"]
        )
    }

    if scores["outline_alignment"] < 60:
        print("ğŸš¨ ä¸¥é‡è­¦å‘Šï¼šæ•…äº‹å·²ä¸¥é‡åç¦»æ€»çº²ï¼")

    return scores
```

---

## å®ç°è®¡åˆ’

### é˜¶æ®µ 1: æ ¸å¿ƒä¿®å¤ï¼ˆå¿…é¡»ï¼‰

1. âœ… ä¿®å¤ä¼ç¬”å¹´é¾„è®¡ç®—
   - æ–‡ä»¶: `src/utils/plot_manager.py`
   - æ”¹ä¸ºå­˜å‚¨ `created_at` å­—æ®µ

2. âœ… å®ç°ä¼ç¬”è§£å†³æ ‡è®°
   - æ·»åŠ  `resolved` å’Œ `resolved_at` å­—æ®µ
   - åœ¨å·å®¡æŸ¥æ—¶è‡ªåŠ¨æ£€æŸ¥

3. âœ… æ›´æ–°çŠ¶æ€ç»“æ„
   - æ–‡ä»¶: `src/state.py`
   - æ·»åŠ ä¸‰å±‚ç»“æ„å­—æ®µ

### é˜¶æ®µ 2: åˆ†å±‚è®°å¿†ï¼ˆæ ¸å¿ƒï¼‰

4. âœ… å®ç°çƒ­/å†·è®°å¿†åˆ†å±‚
   - æ–°æ–‡ä»¶: `src/memory/layered_memory.py`
   - å·å‹ç¼©å‡½æ•°

5. âœ… ä¿®æ”¹ Memory èŠ‚ç‚¹
   - æ–‡ä»¶: `src/nodes/memory.py`
   - é›†æˆåˆ†å±‚è®°å¿†

### é˜¶æ®µ 3: RAG é›†æˆï¼ˆå¢å¼ºï¼‰

6. âœ… é›†æˆ ChromaDB
   - æ–°æ–‡ä»¶: `src/memory/rag_memory.py`
   - å®‰è£…ä¾èµ–: `pip install chromadb`

7. âœ… ä¿®æ”¹ Planner èŠ‚ç‚¹
   - æ–‡ä»¶: `src/nodes/planner.py`
   - é›†æˆ RAG æ£€ç´¢

### é˜¶æ®µ 4: ä¸‰å±‚ç»“æ„ï¼ˆæ¶æ„ï¼‰

8. âœ… å®ç°å·è§„åˆ’èŠ‚ç‚¹
   - æ–°æ–‡ä»¶: `src/nodes/volume_planner.py`

9. âœ… å®ç°é…ç½®æ‰©å±•
   - æ–‡ä»¶: `configure_novel.py`
   - æ”¯æŒç”Ÿæˆæ€»çº²å’Œå·æ¡†æ¶

10. âœ… æ›´æ–°ä¸»å·¥ä½œæµ
    - æ–‡ä»¶: `src/main.py`
    - é›†æˆå·è§„åˆ’æµç¨‹

### é˜¶æ®µ 5: è´¨é‡æ£€æŸ¥ï¼ˆä¿éšœï¼‰

11. âœ… å®ç°å·çº§å®¡æŸ¥
    - æ–°æ–‡ä»¶: `src/nodes/volume_review.py`

12. âœ… å®ç°é‡Œç¨‹ç¢‘å®¡æŸ¥
    - æ–°æ–‡ä»¶: `src/nodes/milestone_review.py`

### é˜¶æ®µ 6: æµ‹è¯•éªŒè¯

13. âœ… åˆ›å»ºæµ‹è¯•è„šæœ¬
    - æ–°æ–‡ä»¶: `test_long_novel.sh`
    - æµ‹è¯•å¤šå·ç”Ÿæˆ

14. âœ… æ–‡æ¡£æ›´æ–°
    - æ›´æ–° README
    - åˆ›å»ºä½¿ç”¨æŒ‡å—

---

## é¢„æœŸæˆæœ

### ç³»ç»Ÿèƒ½åŠ›æå‡

| æŒ‡æ ‡ | v3.0 | v4.0 (é•¿ç¯‡ç‰ˆ) | æå‡ |
|------|------|--------------|------|
| æœ€å¤§ç« èŠ‚æ•° | 100 (ç†è®º) | 200+ | â¬†ï¸ 2å€+ |
| Memory å¤§å° | çº¿æ€§å¢é•¿ | å›ºå®š | â¬†ï¸ ç¨³å®š |
| ç”Ÿæˆé€Ÿåº¦ | çº¿æ€§ä¸‹é™ | ç¨³å®š | â¬†ï¸ ç¨³å®š |
| è§’è‰²ä¸€è‡´æ€§ | ä¸­ç­‰ | é«˜ | â¬†ï¸ 50% |
| ä¸»çº¿è¿è´¯æ€§ | ä¸­ç­‰ | é«˜ | â¬†ï¸ 60% |
| ä¼ç¬”ç®¡ç† | åŸºç¡€ | æ™ºèƒ½ | â¬†ï¸ 100% |

### æˆæœ¬ä¼°ç®—

- 1ç« : $0.08
- 200ç« : $16
- å·è§„åˆ’: 8å· Ã— $0.1 = $0.8
- å·å®¡æŸ¥: 8å· Ã— $0.15 = $1.2
- é‡Œç¨‹ç¢‘å®¡æŸ¥: 4æ¬¡ Ã— $0.3 = $1.2
- **æ€»è®¡**: ~$19.2/æœ¬

---

## é£é™©å’Œç¼“è§£

### é£é™© 1: RAG ä¾èµ–

**é£é™©**: ChromaDB å¯èƒ½ä¸ç¨³å®š
**ç¼“è§£**: RAG åªæ˜¯å¢å¼ºï¼Œä¸æ˜¯å¿…éœ€ã€‚ç³»ç»Ÿå¯ä»¥åœ¨çº¯åˆ†å±‚è®°å¿†ä¸‹è¿è¡Œ

### é£é™© 2: AI æ‘˜è¦è´¨é‡

**é£é™©**: AI ç”Ÿæˆçš„å·æ‘˜è¦å¯èƒ½ä¸¢å¤±é‡è¦ä¿¡æ¯
**ç¼“è§£**:
- ä¿ç•™åŸå§‹ç« èŠ‚æ–‡æœ¬ä½œä¸ºå¤‡ä»½
- å·æ‘˜è¦è´¨é‡è¯„ä¼°
- äººå·¥å®¡æŸ¥ä½åˆ†æ‘˜è¦

### é£é™© 3: å®ç°å¤æ‚åº¦

**é£é™©**: æ–°ç³»ç»Ÿæ¯” v3.0 å¤æ‚å¾—å¤š
**ç¼“è§£**:
- åˆ†é˜¶æ®µå®ç°
- å‘åå…¼å®¹ï¼ˆv3.0 é…ç½®ä»å¯ç”¨ï¼‰
- è¯¦ç»†æ–‡æ¡£å’Œæµ‹è¯•

---

## æ€»ç»“

æœ¬è®¾è®¡é€šè¿‡å››ä¸ªæ ¸å¿ƒæ”¹è¿›è§£å†³é•¿ç¯‡å°è¯´ç”Ÿæˆé—®é¢˜ï¼š

1. **åˆ†å±‚è®°å¿†**: çƒ­/å†·åˆ†ç¦»ï¼Œæ§åˆ¶ prompt é•¿åº¦
2. **RAG å¢å¼º**: è¯­ä¹‰æ£€ç´¢ï¼Œæå‡ä¸Šä¸‹æ–‡ç›¸å…³æ€§
3. **ä¸‰å±‚ç»“æ„**: æ€»çº²â†’å·çº²â†’ç« èŠ‚ï¼Œä¿æŒå…¨å±€è¿è´¯
4. **å¤šå±‚è´¨é‡æ£€æŸ¥**: ç« èŠ‚â†’å·â†’é‡Œç¨‹ç¢‘ï¼Œå…¨æ–¹ä½ä¿éšœ

ç³»ç»Ÿå¯æ‰©å±•è‡³ 200+ ç« ï¼ŒåŒæ—¶ä¿æŒè´¨é‡å’Œæ€§èƒ½ç¨³å®šã€‚
